#!/usr/bin/env perl
# $Id: pyx_html_simple,v 1.11 2005-08-13 18:30:00 skim Exp $

# Pragmas.
use strict;
use warnings;

# Global variables.
use vars qw(@tags @stack $debug);

# Modules.
use PYX::Parser;

# Tags, that are simple.
@tags = ('meta', 'link', 'br', 'hr', 'img', 'input', 'option');

# Debug.
$debug = 0;

# Open file.
my $file_handler = *STDIN;
if ($ARGV[0]) {
	if (! open(INF, "<$ARGV[0]")) {
		die "Cannot open file '$ARGV[0]'.";
	}
	$file_handler = *INF;
}

# PYX::Parser object.
my $pyx_parser = PYX::Parser->new(
	'input_file_handler' => $file_handler,
	'start_tag' => \&_start_tag,
	'end_tag' => \&_end_tag,
	'data' => \&_data,
	'output_rewrite' => 1,
);
$pyx_parser->parse;

# TODO
# Control stack.

# Close file.
if ($ARGV[0]) {
	close(INF);
}

#------------------------------------------------------------------------------
sub _start_tag {
#------------------------------------------------------------------------------
# Process start tag.

	my $obj = shift;
	my $tag = shift;
	_single();
	print "push: " if $debug;	
	push @stack, $tag;
	print "$tag\n" if $debug;
	print $obj->{'line'}, "\n";
}

#------------------------------------------------------------------------------
sub _end_tag {
#------------------------------------------------------------------------------
# Process end tag.

	my $obj = shift;
	_single();
	print "pop: " if $debug;
	my $x = pop @stack;
	print "$x\n" if $debug;
	print $obj->{'line'}, "\n";
}

#------------------------------------------------------------------------------
sub _data {
#------------------------------------------------------------------------------
# Process data.

	my $obj = shift;
	_single();
	print $obj->{'line'}, "\n";
}

#------------------------------------------------------------------------------
sub _single {
#------------------------------------------------------------------------------
# Process end of single.

	my $tag = $stack[$#stack];
	if ($tag && grep(/^$tag$/, @tags)) {
		print ')'.$tag."\n";
		print "pop: " if $debug;
		my $x = pop @stack;
		print "$x\n" if $debug;
	}
}
